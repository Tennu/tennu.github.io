---
layout: plugin
title: Commands Plugin
---

<p class="built-in">This plugin is built-in.</p>

<p>This plugin listens to <a href="messages"><code>privmsg</code></a> events, determining whether it's a command invocation, creating a <a href="/documentation/api-/command-properties"><code>Command</code></a> and firing off a command event when it is. The event name is the name of the command. You can subscribe to these events using the <a href="subscriber"><code>handlers</code></a> plugin hook.</p>

<h3>Example</h3>

{% highlight JavaScript %}
var FooPlugin = {
    name: "ctcp-finger",
    init: function (client, deps) {
        return {
            handlers: {
                "!foo": function (command) {
                    return "bar.";
                }
            }
        };
    },

    // Technically not needed, since Tennu provides
    // these before it even tries to load your plugins.
    requires: ["subscriber", "messages", "commands"]
};

module.exports = FooPlugin;
{% endhighlight %}

<h3>Config</h3>

<dl>
    <dt><code>command-trigger: String</code></dt>
    <dd>The prefix to search for in PRIVMSGs in channels to determine whether the message is a command.</dd>
    <dt><code>command-ignore-list: [String | [String]]</code></dt>
    <dd>
        <p>A list of commands that the handler will not be called for.</p>
        <p>If the entry is a String, then all handler attempts will be ignored.</p>
        <p>
            If the entry is an array of Strings, the first entry in that array will be the command to be
            ignored and the rest of the entries will be plugins to ignore that command from. For example,
            to ignore the <code>say</code> from the <a href="control"><code>control</code></a> plugin, you
            would pass <code>command-ignore-list: [["say", "control"]]</code>.
        </p>
    </dd>
</dl>

<h3>Hooks</h3>

<h4>commandMiddleware</h4>

<p><i>This hook was added in Tennu v4.6.0.</i></p>

<p>The <code>commandMiddleware</code> hook takes a function that gives you a <code>Command</code> that you can choose to modify or not. You must either return that <code>Command</code> or <code>undefined</code> or a Promise of one of those values. If you return <code>undefined</code>, it will cancel the rest of the handling of that command.</p>

<p>You can only have one middleware per plugin, and middlewares are added in the order plugins are loaded.</p>

<p>Middleware is useful for preventing commands from being executed for whatever reason. For instance, a middleware that makes certain commands admin-only could decide to return the Command if the user is an admin, and return undefined if the user is not.</p>

{% highlight javascript %}
// Inside an 'admin' style plugin's init function.

return {
    commandMiddleware: function (command) {
        if (adminOnlyCommands.indexOf(command.command) !== -1) {
            return isCalledByAdmin(command).then(function (isCalledByAdmin) {
                return isCalledByAdmin ? command : undefined;
            });
        } else {
            return command;
        }
    },

    ...
};
{% endhighlight %}

<p>Middleware can also re-order arguments and rename the command.</p>

<p>You <b>MUST NOT</b> change the underlying properties from <code>Message</code> since that will change how other <code>privmsg</code> handlers see the message.</p>

<h3>Exports</h3>

<dl>
    <dt>isCommand(Message)</dt>
    <dd>Returns true if the Message is a command, whether it is handled or not. Otherwise returns false.</dd>

    <dt>isHandledCommand(Message)</dt>
    <dd>Added in v4.4. Returns true if the Message is a command that is handled by a command handler. Otherwise returns false.</dd>
</dl>